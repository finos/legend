<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-community/legend-pct-howto" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">legend-pct-howto | Legend</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://legend.finos.org/docs/community/legend-pct-howto"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="legend-pct-howto | Legend"><meta data-rh="true" name="description" content="Required Development Setup"><meta data-rh="true" property="og:description" content="Required Development Setup"><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://legend.finos.org/docs/community/legend-pct-howto"><link data-rh="true" rel="alternate" href="https://legend.finos.org/docs/community/legend-pct-howto" hreflang="en"><link data-rh="true" rel="alternate" href="https://legend.finos.org/docs/community/legend-pct-howto" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://X69JR631XX-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B6ZG606WLL"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B6ZG606WLL",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Legend" href="/opensearch.xml">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,500,700,900|Source+Code+Pro:400,500,700,900&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/assets/css/styles.b79064f2.css">
<link rel="preload" href="/assets/js/runtime~main.6013d4e0.js" as="script">
<link rel="preload" href="/assets/js/main.2452fc18.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><div class="navbar__brand"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/legend.svg" alt="Legend" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/legend.svg" alt="Legend" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/overview/legend-overview">Docs</a><a class="navbar__item navbar__link" href="/releases">Releases</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>legend-pct-howto</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="required-development-setup">Required Development Setup<a href="#required-development-setup" class="hash-link" aria-label="Direct link to Required Development Setup" title="Direct link to Required Development Setup">​</a></h3><p>Set up develoment environment for <em>legend-pure</em> and <em>legend-engine</em> repositories: </p><ul><li><a href="https://github.com/finos/legend-pure/blob/master/README.md#development-setup" target="_blank" rel="noopener noreferrer">https://github.com/finos/legend-pure/blob/master/README.md#development-setup</a></li><li><a href="https://github.com/finos/legend-engine/blob/master/README.md#development-setup" target="_blank" rel="noopener noreferrer">https://github.com/finos/legend-engine/blob/master/README.md#development-setup</a><ul><li>Note: legend-engine depends on legend-pure. <strong>Modify</strong> <code>legend.pure.version</code> of the legend-engine pom.xml to depend on the legend-pure <strong>SNAPSHOT</strong> version, once you have built legend-pure and before building legend-engine</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="test-your-development-setup">Test your Development Setup<a href="#test-your-development-setup" class="hash-link" aria-label="Direct link to Test your Development Setup" title="Direct link to Test your Development Setup">​</a></h4><p>Once you have built the below repos, try running Pure code</p><p><em>legend-pure</em></p><ul><li><code>TestFunction_TestHelper_Compiled.java</code></li><li><code>TestFunction_TestHelper_Interpreted.java</code></li></ul><p><em>legend-engine</em></p><p>Provided with PureIDE is a <code>welcome.pure</code> file. F9 within this file to execute pure code.</p><h1>PCT Contribution Steps</h1><p><em>Awareness of the dev environment in which each step of the development loop occurs is key to maintaining velocity.</em></p><table><thead><tr><th>Language</th><th>Development Environment</th></tr></thead><tbody><tr><td>Pure</td><td><a href="https://github.com/finos/legend-engine/blob/master/README.md#starting-pure-ide" target="_blank" rel="noopener noreferrer">PureIDE</a></td></tr><tr><td>Java</td><td>IntelliJ</td></tr></tbody></table><p>The Pure Runtime cross-compiles <em>Pure native functions</em> to multiple targets. Native functions have a reference implementation in the Pure Runtime, and are cross-compiled by the Pure Runtime to <em>equivalent</em> implementations in target runtimes. </p><p>Pure has two code paths for cross-compilation
1) <em>Interpreted</em> - Pure code is compiled on the fly (useful for interactive dev).
2)  <em>Compiled</em> - Pure code has already been compiled to a jar (useful for prod).</p><p>Note that PCT Function can be Pure-only (implemented in Pure), or &quot;Native&quot; (implemented in Java). The below steps cover Native Functions, but Pure-only PCT should follow the same principles and similar dev loops.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="native-pct-functions">Native PCT Functions<a href="#native-pct-functions" class="hash-link" aria-label="Direct link to Native PCT Functions" title="Direct link to Native PCT Functions">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-define-the-a-the-native-function-signature-and-b-referencespec-implementation">1. Define the: a) the Native Function Signature, and b) Reference/Spec Implementation<a href="#1-define-the-a-the-native-function-signature-and-b-referencespec-implementation" class="hash-link" aria-label="Direct link to 1. Define the: a) the Native Function Signature, and b) Reference/Spec Implementation" title="Direct link to 1. Define the: a) the Native Function Signature, and b) Reference/Spec Implementation">​</a></h4><p>The <em>Pure Reference/Spec Implementation</em> encapsulates the platform-specific expectations for the behavior of the function; it is implemented as a <em>Native Function</em>. It executes natively in the Pure Runtime and thus is written in Java. </p><p>When defining a Native Function Signature, it is <strong><em>important to compare the equivalent function on at least 2 targets</em></strong>. A minimum of 2 targets helps to ensure our function signature and reference implementation is properly abstracted.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h5><p>These two queries will not yield equivalent results. Further, you can see that the parameters they accept are different.</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// DuckDb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Select time_bucket(Interval &#x27;2 Day&#x27;, timestamp &#x27;2024-01-31 00:32:34&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// results in </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2024-01-31 00:00:00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Snowflake</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT TIME_SLICE(TIMESTAMP_FROM_PARTS(2024, 01, 31, 00, 32, 34), 2, &#x27;DAY&#x27;, &#x27;START&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// results in</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2024-01-30 00:00:00.000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Understanding the minimal common elements to determine the appropriate Native Function signature is key. Consider the set of parameters and input/output required for cross-platform compilation capabilities.</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// for the above, the native function signature we ended up with was:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">native function</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;&lt;PCT.function&gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         doc.doc=&#x27;calculates a time bucket for DateTime, where the bucket is of size quantity unit (e.g. 5 Hour). Uses unix Epoch as the origin for the calculation.&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    meta::pure::functions::date::timeBucket(date:DateTime[1], quantity:Integer[1], unit:DurationUnit[1]):DateTime[1];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//notice how we have a docstring as part of the function signature</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Important: docstrings are Required</strong></p><p>In this example, we only needed one function signature. A native function can have more than one signature. <strong>All signatures for the same native function should be written in the same file.</strong> E.g. the above native function signature and its associated PCT functions exist in <em>timeBucket.pure</em>.</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-envs-pureide-native-function-signature-intellij-referencespec-implementaiton-target-runtimes-for-testing-behavior-of-equivalent-function-eg-duckdb-snowflake">Dev Envs: PureIDE (native function signature); IntelliJ (reference/spec implementaiton), Target runtimes for testing behavior of equivalent function (e.g. DuckDb, Snowflake)*<a href="#dev-envs-pureide-native-function-signature-intellij-referencespec-implementaiton-target-runtimes-for-testing-behavior-of-equivalent-function-eg-duckdb-snowflake" class="hash-link" aria-label="Direct link to Dev Envs: PureIDE (native function signature); IntelliJ (reference/spec implementaiton), Target runtimes for testing behavior of equivalent function (e.g. DuckDb, Snowflake)*" title="Direct link to Dev Envs: PureIDE (native function signature); IntelliJ (reference/spec implementaiton), Target runtimes for testing behavior of equivalent function (e.g. DuckDb, Snowflake)*">​</a></h6><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-native-function-development-loop">2. Native Function Development Loop<a href="#2-native-function-development-loop" class="hash-link" aria-label="Direct link to 2. Native Function Development Loop" title="Direct link to 2. Native Function Development Loop">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2i-start-by-writing-a-draft-native-function-signature-in-pure">2.i. Start by writing a draft native function signature in pure<a href="#2i-start-by-writing-a-draft-native-function-signature-in-pure" class="hash-link" aria-label="Direct link to 2.i. Start by writing a draft native function signature in pure" title="Direct link to 2.i. Start by writing a draft native function signature in pure">​</a></h5><p>Depending on which repo was determined in Step 2, you would use welcome.pure in legend-engine or TestHelper_Interpreted.java in legend-pure.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-testfunction_testhelper_interpretedjava">How to use TestFunction_TestHelper_Interpreted.java<a href="#how-to-use-testfunction_testhelper_interpretedjava" class="hash-link" aria-label="Direct link to How to use TestFunction_TestHelper_Interpreted.java" title="Direct link to How to use TestFunction_TestHelper_Interpreted.java">​</a></h5><p>TestFunction_TestHelper_Interpreted.java (legend-pure)</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @After</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public void cleanRuntime()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        runtime.delete(&quot;myScratchFn.pure&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    protected static FunctionExecution getFunctionExecution()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return new FunctionExecutionInterpreted();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public void testNativeFunctionTesterHelperBeforeAddingToPCT()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        compileTestSource(&quot;myScratchFn.pure&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                         &quot;native function meta::pure::functions::standard::myScratchFn(myString:String[1]):String[2];&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 // this is an example of a pure function call</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;function meta::functions::myScratchFn(myString:String[1]):String[2]&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;{&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;   println(&#x27;123&#x27;);&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;   let myStrList = [$myString, $myString];&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;   println($myStrList);&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;   $myStrList;&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;}&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;function test():Any[*]\n&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;{&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;   let myString = &#x27;abc&#x27;;&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;   meta::functions::myScratchFn($myString);&quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 // if you call this function the call would fail due to missing wiring</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 &quot;   meta::pure::functions::standard::myScratchFn($myString); &quot; +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                &quot;}&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        this.execute(&quot;test():Any[*]&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        runtime.delete(&quot;myScratchFn.pure&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-pureide-welcomepure-legend-engine">How to use PureIDE welcome.pure (legend-engine)<a href="#how-to-use-pureide-welcomepure-legend-engine" class="hash-link" aria-label="Direct link to How to use PureIDE welcome.pure (legend-engine)" title="Direct link to How to use PureIDE welcome.pure (legend-engine)">​</a></h5><p>The same code outlined in the second param of &quot;compileTestSource&quot; in the TestHelper example above, can be written in the go():Any<!-- -->[*]<!-- --> function of welcome.pure. In PureIDE, hitting F9 will execute the code.</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">function go():Any[*]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Your pure code here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-envs-pureide-welcomepure-legend-engine-or-intellij-testfunction_testhelper_interpretedjava-legend-pure">Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)<a href="#dev-envs-pureide-welcomepure-legend-engine-or-intellij-testfunction_testhelper_interpretedjava-legend-pure" class="hash-link" aria-label="Direct link to Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)" title="Direct link to Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)">​</a></h6><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2ii-determine-where-the-signature-of-the-pct-function-and-associated-tests-should-reside">2.ii. Determine where the signature of the PCT Function and associated tests should reside.<a href="#2ii-determine-where-the-signature-of-the-pct-function-and-associated-tests-should-reside" class="hash-link" aria-label="Direct link to 2.ii. Determine where the signature of the PCT Function and associated tests should reside." title="Direct link to 2.ii. Determine where the signature of the PCT Function and associated tests should reside.">​</a></h5><p>Once you know how to run pure code, begin your development loop. Leverage the PCT Taxonomy conventions and the results of weekly Taxonomy review sessions to determine the repo/package in which to put your pure code.</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="pct-taxonomy-conventions">PCT Taxonomy Conventions<a href="#pct-taxonomy-conventions" class="hash-link" aria-label="Direct link to PCT Taxonomy Conventions" title="Direct link to PCT Taxonomy Conventions">​</a></h6><p>The structure of *.pure files containing Platform Functions has been harmonized to reflect the four categories of Pure Functions:</p><ol><li>Grammar (legend-pure) - functions needed for the grammar of the platform. Should almost never be modified. If needed, consult with a Legend CODEOWNER.</li><li>Essential (legend-pure) - foundational functions required for running tests int he platform (e.g. assert, eq). Should almost never be modified. If needed, consult with a Legend CODEOWNER.</li><li>Standard (legend-engine) - majority of platform functions will fall into this category</li><li>Relation (legend-engine) - platform functions specific to operating on relations (e.g. join)</li></ol><p>It was not yet possible to harmonize pure packages to the new taxonomy reflected by the filesystem. Where it makes sense (e.g. adding a brand new package or function), the package name should mirror the new taxonomy reflected by the filesystem. The best example of the ideal taxonomy is the directory structure of legend-pure essential functions; however, please consult with an SME to confirm the proposed package/naming for your PCT function. In the future, pure package naming will be harmonized to follow the new taxonomy.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="example-1">Example<a href="#example-1" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h5><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// PCT Function Signature containing docstring; note that it specifies the expected params, output, and multiplicity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">native function</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;&lt;PCT.function&gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         doc.doc=&#x27;calculates a time bucket for DateTime, where the bucket is of size quantity unit (e.g. 5 Hour). Uses unix Epoch as the origin for the calculation.&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    meta::pure::functions::date::timeBucket(date:DateTime[1], quantity:Integer[1], unit:DurationUnit[1]):DateTime[1];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// this is a &quot;standard&quot; function and so its signature and implemention live in this package:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">legend-engine-core/legend-engine-core-pure/legend-engine-pure-code-functions-standard/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// in the above function signature, you can see the current pure package is</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">meta::pure::functions::date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// filesystem taxonomy of timeBucket.pure file containing the PCT function (in legend-engine)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">core_functions_standard/date/operation/timeBucket.pure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// based on the filesystem taxonomy, ideally the package would be named thusly:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">meta::pure::functions::date::operation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//however, in this instance we kept the existing pure package taxonomy for dates - until the taxonomy has been upgraded, please speak to an SME to double check your proposed package/naming</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-envs-pureide-code-search-legend-engine-intellij-code-search-legend-pure">Dev Envs: PureIDE code search (legend-engine) IntelliJ code search (legend-pure)<a href="#dev-envs-pureide-code-search-legend-engine-intellij-code-search-legend-pure" class="hash-link" aria-label="Direct link to Dev Envs: PureIDE code search (legend-engine) IntelliJ code search (legend-pure)" title="Direct link to Dev Envs: PureIDE code search (legend-engine) IntelliJ code search (legend-pure)">​</a></h6><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2iii-start-writing-some-pure-compatibility-tests-pct-to-encapsulate-the-understanding-gained-in-1-being-careful-to-test-for-edge-cases">2.iii. Start writing some Pure Compatibility Tests (PCT) to encapsulate the understanding gained in 1., being careful to test for edge cases.<a href="#2iii-start-writing-some-pure-compatibility-tests-pct-to-encapsulate-the-understanding-gained-in-1-being-careful-to-test-for-edge-cases" class="hash-link" aria-label="Direct link to 2.iii. Start writing some Pure Compatibility Tests (PCT) to encapsulate the understanding gained in 1., being careful to test for edge cases." title="Direct link to 2.iii. Start writing some Pure Compatibility Tests (PCT) to encapsulate the understanding gained in 1., being careful to test for edge cases.">​</a></h5><p><strong>PCT Tests should be written in the same file as your native function signature</strong></p><p>Note: test package naming is important (examples below).</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="example-2">Example<a href="#example-2" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h6><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Example Good package name: a test package named like so</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">meta::pure::functions::date::tests::timeBucket</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// can be registered in expectedFailuers with one line for unsupported targets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pack(&quot;meta::pure::functions::date::tests::timeBucket&quot;, &quot;\&quot;meta::pure::functions::date::timeBucket_DateTime_1__Integer_1__DurationUnit_1__DateTime_1_ is not supported yet!\&quot;&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Example Bad package name: a test package named like so can only be registered in expectedFailures one by one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">meta::pure::functions::date::tests</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-envs-pureide-welcomepure-legend-engine-or-intellij-testfunction_testhelper_interpretedjava-legend-pure-1">Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)<a href="#dev-envs-pureide-welcomepure-legend-engine-or-intellij-testfunction_testhelper_interpretedjava-legend-pure-1" class="hash-link" aria-label="Direct link to Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)" title="Direct link to Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)">​</a></h6><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2iv-write-the-referencespec-implementation">2.iv. Write the Reference/Spec implementation<a href="#2iv-write-the-referencespec-implementation" class="hash-link" aria-label="Direct link to 2.iv. Write the Reference/Spec implementation" title="Direct link to 2.iv. Write the Reference/Spec implementation">​</a></h5><p>Your native function implementation (Java code) will be split across 3 modules in the taxonomy package:</p><ol><li>-compiled- the compiled module of the function taxonomy will contain the wiring needed by the Pure Runtime to <em>generate the compiled</em> java code</li><li>-interpreted- the interpreted module of the function taxonomy will contain the wiring needed for Pure Runtime to <em>interpret</em> and compile pure code on the fly</li><li>-shared- the class containing the code common to 1 and 2 should be put in this module. These utility classes help avoid duplication.</li></ol><p>Note that you can wire the function in even if it hasn&#x27;t been fully written. Use the helpers described in step 3.i. to test out the wiring of your native function. </p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="example-3">Example<a href="#example-3" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h6><p>see <a href="https://github.com/finos/legend-engine/pull/3491/files#diff-6fdf9132208dc083a35c61ff70294ea2eb3b51e12f167a89f69c4a66bc741c6a" target="_blank" rel="noopener noreferrer">TimeBucketShared in the example PR</a>.</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-env-intellij">Dev Env: IntelliJ<a href="#dev-env-intellij" class="hash-link" aria-label="Direct link to Dev Env: IntelliJ" title="Direct link to Dev Env: IntelliJ">​</a></h6><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2v-running-pcts-against-native-function">2.v. Running PCTs against Native Function<a href="#2v-running-pcts-against-native-function" class="hash-link" aria-label="Direct link to 2.v. Running PCTs against Native Function" title="Direct link to 2.v. Running PCTs against Native Function">​</a></h5><p>Once the native function is wired across the compiled and interpreted paths, you can loop and iterate to refine the signature, implementation, and tests, using the <em>InMemory PCT Adapter</em>. PCT Adapters are functions that enable the cross-compilation and evaluation of PCT functions on target environments. The InMemory adapter does a pass-through to the Pure Runtime and is useful for running the native reference/spec implementation.</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="example-usage">Example Usage<a href="#example-usage" class="hash-link" aria-label="Direct link to Example Usage" title="Direct link to Example Usage">​</a></h6><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let inmemoryadapter = meta::pure::test::pct::testAdapterForInMemoryExecution_Function_1__X_o_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// runs the PCT &quot;testTimeBucketSeconds&quot; against Reference Implementation (eval in pure runtime)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">meta::pure::functions::date::tests::testTimeBucketSeconds($inmemoryadapter);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-envs-pureide-welcomepure-legend-engine-or-intellij-testfunction_testhelper_interpretedjava-legend-pure-2">Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)<a href="#dev-envs-pureide-welcomepure-legend-engine-or-intellij-testfunction_testhelper_interpretedjava-legend-pure-2" class="hash-link" aria-label="Direct link to Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)" title="Direct link to Dev Envs: PureIDE welcome.pure (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)">​</a></h6><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-target-cross-compilation-development-loop">3. Target (cross-compilation) development loop<a href="#3-target-cross-compilation-development-loop" class="hash-link" aria-label="Direct link to 3. Target (cross-compilation) development loop" title="Direct link to 3. Target (cross-compilation) development loop">​</a></h4><p>Once you have completed the Native Function development loop, it is time to wire your native function to cross-compile to the target environments (legend-engine)</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3i-pcts-and-puretotarget-wiring-eg-puretosql">3.i. PCTs and PureToTarget wiring (e.g. PureToSQL).<a href="#3i-pcts-and-puretotarget-wiring-eg-puretosql" class="hash-link" aria-label="Direct link to 3.i. PCTs and PureToTarget wiring (e.g. PureToSQL)." title="Direct link to 3.i. PCTs and PureToTarget wiring (e.g. PureToSQL).">​</a></h5><p>PCT are useful for testing your wiring, as they are evaluated in the context of the target platform. The assert happens in the Pure Runtime, but the assertion is over the result of an eval on the target platform (i.e. that the cross-compilation behaves as the platform expects).</p><p>PCT Adapters are functions that enable the cross-compilation of PCT to target environments. To find a current list of adapters, search for the phrase <code>&lt;&lt;PCT.adapter&gt;&gt;</code> in PureIDE. Notes on selected adapter are below:</p><table><thead><tr><th>Target</th><th>Notes</th></tr></thead><tbody><tr><td>Snowflake</td><td>Snowflake integration requires connection to your Snowflake account. Look at the code in SnowflakeTestConnectionIntegration and set up neded env vars for accessing snowflake in order to run this adapter.</td></tr><tr><td>Java Platform Binding</td><td>Legend platform has the capability of generating java code from pure code. Think of it as the equivalent of pureToSQL but it&#x27;s pureToJava instead. This is distinct from Pure Runtime java code. This is code generated by the Pure Runtime itself to encapsulate queries meant to run on a Java Target Environment.</td></tr></tbody></table><h5 class="anchor anchorWithStickyNavbar_LWe7" id="example-target-adapter-usage">Example Target Adapter Usage<a href="#example-target-adapter-usage" class="hash-link" aria-label="Direct link to Example Target Adapter Usage" title="Direct link to Example Target Adapter Usage">​</a></h5><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let duckdbadapter = meta::relational::tests::pct::testAdapterForRelationalWithDuckDBExecution_Function_1__X_o_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// runs the PCT &quot;testTimeBucketSeconds&quot; against DuckDb (eval on DuckDb)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">meta::pure::functions::date::tests::testTimeBucketSeconds($duckdbadapter);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="example-target-sql-wiring-for-timebucket-native-function">Example Target SQL wiring for timeBucket native function<a href="#example-target-sql-wiring-for-timebucket-native-function" class="hash-link" aria-label="Direct link to Example Target SQL wiring for timeBucket native function" title="Direct link to Example Target SQL wiring for timeBucket native function">​</a></h5><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// PureToDuckDb - this code was added in duckdbExtension.pure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dynaFnToSql(&#x27;timeBucket&#x27;,             $allStates,            ^ToSql(format=&#x27;cast(time_bucket(%s) as timestamp_s)&#x27;, transform={p:String[3] | constructIntervalFunction($p-&gt;at(2), $p-&gt;at(1)) + &#x27;, &#x27; + $p-&gt;at(0) + &#x27;, &#x27; + constructTimeBucketOffset($p-&gt;at(2))})),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// DuckDb uses a different origin for calculation of timebuckets; this offset helps to standardize toward unix epoch as origin and</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// the offset for intervals &lt; WEEK are set to align with Snowflake&#x27;s methodology, as opposed to that which is outlined in DuckDb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ref: https://github.com/duckdb/duckdb/blob/68bd4a5277430245e3d9edf1abbb9813520a3dff/extension/core_functions/scalar/date/time_bucket.cpp#L18</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">function meta::relational::functions::sqlQueryToString::duckDB::constructTimeBucketOffset(unit:String[1]):String[1]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let unitWithoutQuotes = $unit-&gt;removeQuotesIfExist();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let ISOMondayEpochOffset = &#x27;timestamp \&#x27;1969-12-29 00:00:00\&#x27;&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let EpochOffset = &#x27;timestamp \&#x27;1970-01-01 00:00:00\&#x27;&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let offset = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.YEARS-&gt;toString(), $EpochOffset),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.MONTHS-&gt;toString(), $EpochOffset),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.WEEKS-&gt;toString(), $ISOMondayEpochOffset),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.DAYS-&gt;toString(), $EpochOffset),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.HOURS-&gt;toString(), $EpochOffset),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.MINUTES-&gt;toString(), $EpochOffset),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.SECONDS-&gt;toString(), $EpochOffset)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   ]-&gt;filter(p | $p.first == $unitWithoutQuotes).second-&gt;toOne(&#x27;Unit not found: &#x27; + $unitWithoutQuotes);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// PureToSnowflake - this code was added in snowflakeExtension.pure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dynaFnToSql(&#x27;timeBucket&#x27;,             $allStates,            ^ToSql(format=&#x27;TIME_SLICE(%s)&#x27;, transform={p:String[3]|$p-&gt;at(0) + &#x27;, &#x27; + constructInterval($p-&gt;at(2), $p-&gt;at(1))})),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">function meta::relational::functions::sqlQueryToString::snowflake::constructInterval(unit:String[1], i:String[1]):String[1]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   let unitWithoutQuotes = $unit-&gt;removeQuotesIfExist();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   let interval= [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.YEARS-&gt;toString(), &#x27;\&#x27;YEAR\&#x27;&#x27;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.MONTHS-&gt;toString(), &#x27;\&#x27;MONTH\&#x27;&#x27;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.WEEKS-&gt;toString(), &#x27;\&#x27;WEEK\&#x27;&#x27;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.DAYS-&gt;toString(), &#x27;\&#x27;DAY\&#x27;&#x27;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.HOURS-&gt;toString(), &#x27;\&#x27;HOUR\&#x27;&#x27;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.MINUTES-&gt;toString(), &#x27;\&#x27;MINUTE\&#x27;&#x27;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      pair(DurationUnit.SECONDS-&gt;toString(), &#x27;\&#x27;SECOND\&#x27;&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   ]-&gt;filter(p | $p.first == $unitWithoutQuotes).second-&gt;toOne(&#x27;Unit not supported: &#x27; + $unitWithoutQuotes);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $i + &#x27;, &#x27; + $interval;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-envs-pureide-legend-engine">Dev Envs: PureIDE (legend-engine)<a href="#dev-envs-pureide-legend-engine" class="hash-link" aria-label="Direct link to Dev Envs: PureIDE (legend-engine)" title="Direct link to Dev Envs: PureIDE (legend-engine)">​</a></h6><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3ii-native-function-registration-in-handlersjava-and-other-relevant-files">3.ii. Native Function Registration in Handlers.java and other relevant files.<a href="#3ii-native-function-registration-in-handlersjava-and-other-relevant-files" class="hash-link" aria-label="Direct link to 3.ii. Native Function Registration in Handlers.java and other relevant files." title="Direct link to 3.ii. Native Function Registration in Handlers.java and other relevant files.">​</a></h5><p>To find the places where you may need to wire in the function, you should Ctrl+Shift+F (IntelliJ) to see how similar functions were wired.</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-env-intellij-1">Dev Env: IntelliJ<a href="#dev-env-intellij-1" class="hash-link" aria-label="Direct link to Dev Env: IntelliJ" title="Direct link to Dev Env: IntelliJ">​</a></h6><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3iii-update-expectedfailures-of-pct-targets-where-you-have-not-yet-implemented-the-function">3.iii. Update ExpectedFailures of PCT Targets where you have not yet implemented the function.<a href="#3iii-update-expectedfailures-of-pct-targets-where-you-have-not-yet-implemented-the-function" class="hash-link" aria-label="Direct link to 3.iii. Update ExpectedFailures of PCT Targets where you have not yet implemented the function." title="Direct link to 3.iii. Update ExpectedFailures of PCT Targets where you have not yet implemented the function.">​</a></h5><p>In legend-engine, Ctrl+Shift+N (IntelliJ file-search) in IntelliJ for <code>Test_*_PCT</code> to find the relevant files of targets where you will need to register your expectedFailures.</p><p>You can build these modules individually to run the tests - avoid rebuilding the entire project.</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-env-intellij-2">Dev Env: IntelliJ<a href="#dev-env-intellij-2" class="hash-link" aria-label="Direct link to Dev Env: IntelliJ" title="Direct link to Dev Env: IntelliJ">​</a></h6><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3iv-leverage-adapters-to-easily-run-the-pct-tests-written-in-the-native-function-development-loop-against-target-environments">3.iv. Leverage Adapters to easily run the PCT Tests written in the Native Function Development Loop against target environments.<a href="#3iv-leverage-adapters-to-easily-run-the-pct-tests-written-in-the-native-function-development-loop-against-target-environments" class="hash-link" aria-label="Direct link to 3.iv. Leverage Adapters to easily run the PCT Tests written in the Native Function Development Loop against target environments." title="Direct link to 3.iv. Leverage Adapters to easily run the PCT Tests written in the Native Function Development Loop against target environments.">​</a></h5><p>You may need to loop between this step and earlier steps to improve what you wrote previously. Remember that if you are developing in legend-pure, <code>TestFunction_TestHelper_Compiled.java</code> and <code>TestFunction_TestHelper_Interpreted.java</code> enable you to run pure code without having to rebuild/restart PureIDE in legend-engine.</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-envs-pureide-legend-engine-or-intellij-testfunction_testhelper_interpretedjava-legend-pure">Dev Envs: PureIDE (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)<a href="#dev-envs-pureide-legend-engine-or-intellij-testfunction_testhelper_interpretedjava-legend-pure" class="hash-link" aria-label="Direct link to Dev Envs: PureIDE (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)" title="Direct link to Dev Envs: PureIDE (legend-engine) or IntelliJ TestFunction_TestHelper_Interpreted.java (legend-pure)">​</a></h6><hr><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-final-step-preparing-for-pr">4. FINAL Step: Preparing for PR<a href="#4-final-step-preparing-for-pr" class="hash-link" aria-label="Direct link to 4. FINAL Step: Preparing for PR" title="Direct link to 4. FINAL Step: Preparing for PR">​</a></h4><p>This should be the Final Step and should only happen Once. <strong><em>Maven builds are expensive and should be avoided until absolutely necessary.</em></strong>
Run mvn clean install with tests in order to identify any potential tests that could fail due to your new module</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="example-command-to-build-with-threads">Example command to build with threads<a href="#example-command-to-build-with-threads" class="hash-link" aria-label="Direct link to Example command to build with threads" title="Direct link to Example command to build with threads">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mvn clean install -T 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-prs">Example PRs<a href="#example-prs" class="hash-link" aria-label="Direct link to Example PRs" title="Direct link to Example PRs">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="new-native-function">New Native Function<a href="#new-native-function" class="hash-link" aria-label="Direct link to New Native Function" title="Direct link to New Native Function">​</a></h5><p><a href="https://github.com/finos/legend-engine/pull/3491/files" target="_blank" rel="noopener noreferrer">timeBucket</a></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="conversion-of-existing-function-to-pct">Conversion of Existing Function to PCT<a href="#conversion-of-existing-function-to-pct" class="hash-link" aria-label="Direct link to Conversion of Existing Function to PCT" title="Direct link to Conversion of Existing Function to PCT">​</a></h5><p><a href="https://github.com/finos/legend-engine/pull/3424/files#diff-00c42b86368a6fcd15328a4041dbacdd70df22b3ecab95e3c75138af224c3f2e" target="_blank" rel="noopener noreferrer">https://github.com/finos/legend-engine/pull/3424/files#diff-00c42b86368a6fcd15328a4041dbacdd70df22b3ecab95e3c75138af224c3f2e</a></p><hr><h1>Appendix</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="legend-platform-conventions">Legend Platform Conventions<a href="#legend-platform-conventions" class="hash-link" aria-label="Direct link to Legend Platform Conventions" title="Direct link to Legend Platform Conventions">​</a></h2><p>Conventions ensure that we can achieve <strong>Goal - a clean (minimal) and transparent platform api</strong>.</p><p>It is critical that utmost care is taken when deciding on:</p><ul><li>Function Signature</li><li>Code Location</li><li>Naming/Style</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="style">Style<a href="#style" class="hash-link" aria-label="Direct link to Style" title="Direct link to Style">​</a></h3><ul><li>One file per PCT Function<ul><li>All Function Signatures for the PCT Function belong in the same file</li><li>All PCT tests for the PCT function belong in the same file</li></ul></li><li>package names are all lower-case</li><li>function names are camelCase, with the first letter lower-case</li><li>function signatures <strong>must have docstring (doc.doc)</strong></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practices">Practices<a href="#practices" class="hash-link" aria-label="Direct link to Practices" title="Direct link to Practices">​</a></h3><p>PCT measure the level of cross-target support for a given Platform Function. When contributing to PCT on Legend, keep this preference order in mind:</p><p><code>PCT Passed(Green) &gt; Failed PCT with Good Error Message &gt; Failed PCT</code></p><p><em>One key priority is to improve error messages on the platform - Good Error Messages are important.</em></p><p>Note: It is highly unlikely you will need to make changes to existing reference specs/implementations. If you feel the need, contact a CODEOWNER on your proposed change.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#required-development-setup" class="table-of-contents__link toc-highlight">Required Development Setup</a></li><li><a href="#native-pct-functions" class="table-of-contents__link toc-highlight">Native PCT Functions</a></li><li><a href="#legend-platform-conventions" class="table-of-contents__link toc-highlight">Legend Platform Conventions</a><ul><li><a href="#style" class="table-of-contents__link toc-highlight">Style</a></li><li><a href="#practices" class="table-of-contents__link toc-highlight">Practices</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="https://www.finos.org" class="nav-home"><img src="https://legend.finos.org/img/finos_wordmark.svg" alt="FINOS"></a></section><section class="finos finosBanner"><a href="https://www.finos.org"><img id="finosicon" src="https://legend.finos.org/img/finos_wordmark.svg" height="75px" alt="FINOS" title="FINOS"></a></section><section class="privacy finosBanner"><a href="https://www.finos.org/privacy-policy" target="_blank">Privacy Policy</a></section></footer></div>
<script src="/assets/js/runtime~main.6013d4e0.js"></script>
<script src="/assets/js/main.2452fc18.js"></script>
</body>
</html>